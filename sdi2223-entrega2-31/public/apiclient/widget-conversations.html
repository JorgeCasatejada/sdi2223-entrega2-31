<div id="widget-songs" >

  <button class="btn" onclick="loadConversations()" >Actualizar</button>
  <table class="table table-hover">
    <thead>
    <tr>
      <th><a onclick="sortByTitle()">Título de la oferta</a></th>
      <th>Email del vendedor</th>
      <th>Email del interesado</th>
      <th class="col-md-1"></th>
      <th>Mensajes no leídos</th>
    </tr>
    </thead>
    <tbody id="conversationsTableBody"></tbody>
  </table>
</div>

<script>
  window.history.pushState("", "", "/apiclient/client.html?w=conversations");

  if(intervaloActualización !== undefined) {
    clearInterval(intervaloActualización);
  }

  var conversations;
  var selectedConversationId;

  function loadConversations() {
    $.ajax({
      url: URLbase + "/convers/all",
      type: "GET",
      data: {},
      dataType: 'json',
      headers: {"token": token},
      success: function (response) {
        conversations = response.convers;
        updateConversationsTable(conversations);
      },
      error: function (error) {
        $("#main-container").load("widget-login.html");
      }
    });
  }
  function updateConversationsTable(conversations) {
    $("#conversationsTableBody").empty(); // Vaciar la tabla
    for (i = 0; i < conversations.length; i++) {
      $("#conversationsTableBody").append(
              "<tr id=" + conversations[i]._id + ">" +
              "<td>" + conversations[i].offerTitle + "</td>" +
              "<td>" + conversations[i].owner + "</td>" +
              "<td>" + conversations[i].offertant + "</td>" +
              "<td>" +
              "<a onclick=conversationView('" + conversations[i]._id + "')>Reanudar</a><br>" +
              "<a onclick=conversationDelete('" + conversations[i]._id + "')>Eliminar</a>" +
              "</td>" +
              "<td>" + conversations[i].unReadMessages + "</td>" +
              "</tr>");
    }
  }

  function conversationDelete(_id) {
    $.ajax({
      url: URLbase + "/convers/delete/" + _id,
      type: "DELETE",
      data: {},
      dataType: 'json',
      headers: {"token": token},
      success: function (response) {
        $("#" + _id).remove(); // eliminar el <tr> de la canción
      },
      error: function (error) {
        $("#main-container").load("widget-login.html");
      }
    });
  }

  function conversationView(_id) {
    selectedConversationId = _id;
    $("#main-container").load("widget-chat.html");
  }

  function autoUpdate() {
    $.ajax({
      url: URLbase + "/convers/all",
      type: "GET",
      data: {},
      dataType: 'json',
      headers: {"token": token},
      success: function (response) {
        conversations = response.convers;
        updateConversationsTable(conversations);
      },
      error: function (error) {
        $("#main-container").load("widget-login.html");
      }
    });
  }

  intervaloActualización = setInterval(autoUpdate, 1000);

  // loadConversations();

</script>